<!DOCTYPE html>
<html>
	<head>
	<title>YouTube Search</title>
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css" rel="stylesheet">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js">
	</script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js">
	</script>
	<link rel="stylesheet" type="text/css" href="css/my_uploads.css">
	</head>
	<body>
<div id="header"></div>
<section class="jumbotron">
      <h1 class="text-center">Search YouTube</h1>
      <div class="row">
    <div class="col-md-6 col-md-offset-3 text-center">
          <button class="btn btn-green center-block" id="execute-request-button" type="button">Authorize</button>
          <label>Search Term
        <input id="term" name="term" type="text">
      </label>
          <br>
          <button class="btn btn-purple center-block" id="search" type="button">Search</button>
        </div>
  </div>
    </section>
<section class="alert alert-info">
      <div id="results"></div>
    </section>
<footer id="footer"></footer>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js">
	</script> 
<script async defer onload="this.onload=function(){};handleClientLoad()" onreadystatechange="if (this.readyState === 'complete') this.onload()" src="https://apis.google.com/js/api.js">
	</script> 
<script src="includes/navigation.js">
	</script> 
<script src="includes/autosize.js">
	</script> 
<script>
	        /***** START BOILERPLATE CODE: Load client library, authorize user. *****/

	 // Global variables for GoogleAuth object, auth status.
	 var GoogleAuth,auth,searchResults,resultType;

	 /**
	  * Load the API's client and auth2 modules.
	  * Call the initClient function after the modules load.
	  */
	 function handleClientLoad() {
	   gapi.load('client:auth2', initClient);
	 }

	 function initClient() {
	   // Initialize the gapi.client object, which app uses to make API requests.
	   // Get API key and client ID from API Console.
	   // 'scope' field specifies space-delimited list of access scopes

	   gapi.client.init({
	       'clientId': '90875073625-c3k22oeo15lc8p086cf2307pmoatehp1.apps.googleusercontent.com',
	       'discoveryDocs': ['https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest'],
	       'scope': 'https://www.googleapis.com/auth/youtube.force-ssl https://www.googleapis.com/auth/youtubepartner'
	   }).then(function () {
	     GoogleAuth = gapi.auth2.getAuthInstance();

	     // Listen for sign-in state changes.
	     GoogleAuth.isSignedIn.listen(updateSigninStatus);

	     // Handle initial sign-in state. (Determine if user is already signed in.)
	     setSigninStatus();

	     // Call handleAuthClick function when user clicks on "Authorize" button.
	     $('#execute-request-button').click(function() {
	       handleAuthClick(event);
	     }); 
	   });
	 }

	 function handleAuthClick(event) {
	   // Sign user in after click on auth button.
	   GoogleAuth.signIn();
	 }
	$('#search').click(function(){
	   if(auth){
	       defineRequest();
	   }
	})
	 function setSigninStatus() {
	   var user = GoogleAuth.currentUser.get();
	   isAuthorized = user.hasGrantedScopes('https://www.googleapis.com/auth/youtube.force-ssl https://www.googleapis.com/auth/youtubepartner');
	   // Toggle button text and displayed statement based on current auth status.
	   if (isAuthorized) {
	     auth = true;
	   }
	 }

	 function updateSigninStatus(isSignedIn) {
	   setSigninStatus();
	 }

	 function createResource(properties) {
	   var resource = {};
	   var normalizedProps = properties;
	   for (var p in properties) {
	     var value = properties[p];
	     if (p && p.substr(-2, 2) == '[]') {
	       var adjustedName = p.replace('[]', '');
	       if (value) {
	         normalizedProps[adjustedName] = value.split(',');
	       }
	       delete normalizedProps[p];
	     }
	   }
	   for (var p in normalizedProps) {
	     // Leave properties that don't have values out of inserted resource.
	     if (normalizedProps.hasOwnProperty(p) && normalizedProps[p]) {
	       var propArray = p.split('.');
	       var ref = resource;
	       for (var pa = 0; pa < propArray.length; pa++) {
	         var key = propArray[pa];
	         if (pa == propArray.length - 1) {
	           ref[key] = normalizedProps[p];
	         } else {
	           ref = ref[key] = ref[key] || {};
	         }
	       }
	     };
	   }
	   return resource;
	 }

	 function removeEmptyParams(params) {
	   for (var p in params) {
	     if (!params[p] || params[p] == 'undefined') {
	       delete params[p];
	     }
	   }
	   return params;
	 }

	 function executeRequest(request) {
	   request.execute(function(response) {
	       searchResults = response.items;
           console.log( searchResults);
	       var i=0;
	       while(searchResults){
               resultType = response.items[i].id.kind;
	     console.log(i + ':' +resultType);
              if(resultType.indexOf("video") >0){
                  videoID = response.items[i].id.videoId;
              }
               else if(resultType.indexOf("play") >0){
                       videoID = response.items[i].id.playlistID;
                       }
               else if(resultType.indexOf("channel") >0){
                   videoID = response.items[i].id.playlistID;
               }
var search =  searchResults[i].snippet;
	    var channel = search.channelTitle;
	   var title = search.title;
	   var thumbnail = search.thumbnails.high.url;
	   $('#results').append( '<h3>Video #' + i + ' Channel: ' + channel + 'Title: ' + title + 'id:' + videoID + '</h3><br />');
	   $('#results').append($('<img>',{id:'theImg',src:thumbnail}))
	   $('#results').append( '<br />');
	   i++;
	       }
	       });
	 }
	 function buildApiRequest(requestMethod, path, params, properties) {
	   params = removeEmptyParams(params);
	   var request;
	   if (properties) {
	     var resource = createResource(properties);
	     request = gapi.client.request({
	         'body': resource,
	         'method': requestMethod,
	         'path': path,
	         'params': params
	     });
	   } else {
	     request = gapi.client.request({
	         'method': requestMethod,
	         'path': path,
	         'params': params
	     });
	   }
	   executeRequest(request);
	 }

	 /***** END BOILERPLATE CODE *****/

	 
	 function defineRequest() {
	   // See full sample for buildApiRequest() code, which is not 
	// specific to a particular API or API method.
	term = $('#term').val();
	buildApiRequest('GET',
	               '/youtube/v3/search',
	               {'maxResults': '25',
	                'part': 'snippet',
	                'q': term,
	                'type': ''});

	 }
	       autosize( document.querySelectorAll( 'textarea' ) );
	</script>
</body>
</html>
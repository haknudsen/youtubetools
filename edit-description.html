<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Edit Description</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<link rel="stylesheet" type="text/css" href="css/my_uploads.css">
</head>
<body>
<div id="header"></div>
<section class="container-fluid">
  <div class="text-center">
    <button id="execute-request-button" class="btn btn-danger">Authorize</button>
    <br>
    <label class="m-1">Enter Video ID
      <input type="text" id="video">
    </label>
    <br>
    <button type="button" class="btn btn-danger" id="getVideo">Get Video</button>
    <button type="button" class="btn btn-purple" id="update">Update</button>
  </div>
</section>
<div class="alert alert-info">
  <div class="row">
    <div class="col-sm-6">
      <h3 class="text-capitalize text-center">title</h3>
      <input type="text" id="title">
    </div>
    <div class="col-sm-2">
      <h3 class="text-capitalize text-center">Language</h3>
      <select  id="language" title="Language">
        <option value="en" selected>English</option>
      </select>
    </div>
    <div class="col-sm-2">
      <h3 class="text-capitalize text-center">category</h3>
      <input id="category" type="text">
    </div>
  </div>
  <div class="row">
    <div class="col-sm-6">
      <h3 class="text-capitalize text-center">description</h3>
      <textarea id="description"></textarea>
      <div class="m-1">
        <h3  class="text-capitalize text-center">Total Letter Count : <span id="counter">0</span></h3>
      </div>
    </div>
    <div class="col-sm-6">
      <h3 class="text-capitalize text-center">tags</h3>
      <textarea id="tags"></textarea>
      <h3  class="text-capitalize text-center">Total Letter Count : <span id="counter2">0</span></h3>
    </div>
  </div>
</div>
<div id="footer"></div>
<script>

  /***** START BOILERPLATE CODE: Load client library, authorize user. *****/

  // Global variables for GoogleAuth object, auth status.
var GoogleAuth, title, description, channel, snippet, videoId, getVideo, categoryId,defaultLanguage;
var tags = Array();
var videoUpdate =false;

  /**
   * Load the API's client and auth2 modules.
   * Call the initClient function after the modules load.
   */
  function handleClientLoad() {
    gapi.load('client:auth2', initClient);
  }

  function initClient() {
    // Initialize the gapi.client object, which app uses to make API requests.
    // Get API key and client ID from API Console.
    // 'scope' field specifies space-delimited list of access scopes

    gapi.client.init({
        'clientId': '90875073625-ff3ntj9kehegnbamaoace12q6lo37v6u.apps.googleusercontent.com',
        'discoveryDocs': ['https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest'],
        'scope': 'https://www.googleapis.com/auth/youtube.force-ssl https://www.googleapis.com/auth/youtubepartner'
    }).then(function () {
      GoogleAuth = gapi.auth2.getAuthInstance();

      // Listen for sign-in state changes.
      GoogleAuth.isSignedIn.listen(updateSigninStatus);

      // Handle initial sign-in state. (Determine if user is already signed in.)
      setSigninStatus();

      // Call handleAuthClick function when user clicks on "Authorize" button.
      $('#execute-request-button').click(function() {
        handleAuthClick(event);
      }); 
    });
  }

  function handleAuthClick(event) {
    // Sign user in after click on auth button.
    GoogleAuth.signIn();
  }

  function setSigninStatus() {
    var user = GoogleAuth.currentUser.get();
    isAuthorized = user.hasGrantedScopes('https://www.googleapis.com/auth/youtube.force-ssl https://www.googleapis.com/auth/youtubepartner');
    // Toggle button text and displayed statement based on current auth status.
    if (isAuthorized) {
        $('#getVideo').addClass('btn-green');
        $('#execute-request-button').addClass('btn-green');
        $('#getVideo').click(function () {
            getVideo = $('#video').val();
            getVideo = getVideo.substring(getVideo.lastIndexOf("=") + 1);
            videoUpdate =false;
            buildApiRequest('GET',
                '/youtube/v3/videos',
                {'id': getVideo,
                 'part': 'snippet'});
        });
        $('#update').click(function(){
            videoUpdate = true;
                defineRequest();
        })
    }
  }

  function updateSigninStatus(isSignedIn) {
    setSigninStatus();
  }

  function createResource(properties) {
    var resource = {};
    var normalizedProps = properties;
    for (var p in properties) {
      var value = properties[p];
      if (p && p.substr(-2, 2) == '[]') {
        var adjustedName = p.replace('[]', '');
        if (value) {
          normalizedProps[adjustedName] = value.split(',');
        }
        delete normalizedProps[p];
      }
    }
    for (var p in normalizedProps) {
      // Leave properties that don't have values out of inserted resource.
      if (normalizedProps.hasOwnProperty(p) && normalizedProps[p]) {
        var propArray = p.split('.');
        var ref = resource;
        for (var pa = 0; pa < propArray.length; pa++) {
          var key = propArray[pa];
          if (pa == propArray.length - 1) {
            ref[key] = normalizedProps[p];
          } else {
            ref = ref[key] = ref[key] || {};
          }
        }
      };
    }
    return resource;
  }

  function removeEmptyParams(params) {
    for (var p in params) {
      if (!params[p] || params[p] == 'undefined') {
        delete params[p];
      }
    }
    return params;
  }

  function executeRequest(request) {
    request.execute(function(response) {
      console.log(response);
        if(!videoUpdate){
            snippet = response.items[0].snippet;
            $('#description').val(snippet.description) ;
$('#tags').val(snippet.tags);
$('#title').val(snippet.title);
$('#category').val(snippet.categoryId);
$('#language').val(snippet.defaultLanguage);
        }
    });
  }

  function buildApiRequest(requestMethod, path, params, properties) {
    params = removeEmptyParams(params);
    var request;
    if (properties) {
      var resource = createResource(properties);
      request = gapi.client.request({
          'body': resource,
          'method': requestMethod,
          'path': path,
          'params': params
      });
    } else {
      request = gapi.client.request({
          'method': requestMethod,
          'path': path,
          'params': params
      });
    }
    executeRequest(request);
  }

  /***** END BOILERPLATE CODE *****/

  
  function defineRequest() {
    // See full sample for buildApiRequest() code, which is not 
// specific to a particular youtube or youtube method.
      description = $('#description').val() ;
      tags = $('#tags').val();
      title = $('#title').val();
      categoryId = $('#category').val();
      defaultLanguage = $('#language').val();
buildApiRequest('PUT',
                '/youtube/v3/videos',
                {'part': 'snippet'},
                {'id': 'pJHh7k8hWnE',
                 'snippet.categoryId':categoryId,
                 'snippet.defaultLanguage': defaultLanguage,
                 'snippet.description': description,
                 'snippet.tags[]': '',
                 'snippet.title': title
      });

  }
</script> 
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script> 
<script src="includes/header-autoresize.js"></script> 
<script async defer src="https://apis.google.com/js/api.js" 
        onload="this.onload=function(){};handleClientLoad()" 
        onreadystatechange="if (this.readyState === 'complete') this.onload()">
</script>
</body>
</html>